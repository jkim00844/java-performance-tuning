# Story13 XML과 JSON도 잘 쓰자

요즘 자바로 개발할 때 각종 설정 파일과 DB 쿼리를 XML에서 관리하는 것은 기본이고,  
데이터를 XML 및 JSON 타입으로 주고 받는 시스템도 늘어나고 있다.  
하지만 XML이나 JSON을 쓸 경우 시스템의 성능이 안 좋아질 수도 있다.   
필요에 따라서 써야 할 곳에서는 쓰는 것이 좋지만,   
꼭 그럴 필요가 없는 곳까지 맹목적으로쓰는 것은 좋지 않다.  

자바에서는 XML을 파싱하기 위해서 JAXP(Java API for XML Processing)를 제공한다.

JAXP는 SAX, DOM, XSLT에서 사용하는 기본 API를 제공한다.  
이 중 사용하기 적합한 파서는 SAX와 DOM이다.

**SAX 파서**  
SAX 파서는 순차적으로 처리하는 이벤트 기반의 모델이다. 

**DOM 파서**

XML을 트리 형태의 데이터로 먼저 만든 후, 그 데이터를 가공하는 방식을 사용한다.

SAX 파서와 DOM 파서 

| 대상 | 응답 시간(마이크로초) | 대상 | 응답 시간(마이크로초) |
| --- | --- | --- | --- |
| SAX 100 | 847 | DOM 100 | 1,395 |
| SAX 1000 | 3,925 | DOM 1,000 | 7,129 |

데이터의 크기가 커지면 커질수록 두 파서간의 차이가 커진다.  
처리하는 데 소요되는 대부분의 시간은 parse() 메서드에서 처리하는 CPU 시간이다.  
즉, 대기 시간은 없지만, XML을 처리하는 과정에서 CPU에 순간적으로 많은 부하가 발생하는 것이다.


**JSON과 파서들**

JSON 구조

- name/value 형태의 쌍으로 collection 타입
- 값의 순서가 있는 목록 타입

JSON도 많은 CPU와 메모리를 점유하며 응답 시간도 느리다.  
만약 꼭 써야한다면 어쩔수 없지만 그런 상황이 아니라면 데이터 전송을 위한 라이브러리를 사용하는 것이 좋다.

가장 많이 사용되는 JSON 파서로는 Jackson JSON과 google-gson등이 있다.

XML과 JSON

| 데이터 개수 | XML SAX | XML DOM | JSON |
| --- | --- | --- | --- |
| 100 | 847 | 1,395 | 245 |
| 1,000 | 3,925 | 7,129 | 1,379 |

JSON 파싱이 XML 파싱보다 빠르지만   
데이터를 전송하기 위해서 XML 및 JSON 데이터를 Serialize와 Deserialize 할 경우   
JSON 데이터는 Serialize와 Deserialize를 처리하는 성능이 좋지 않다.  

**데이터 전송을 빠르게 하는 라이브러리 소개**  
일반적으로 많이 사용되는 라이브러리에는 protobuf, Thrift, avro 등이 있다.

대부분 정해진 표준 프로토콜만으로 통신하거나 JSON이나 XML 등 텍스트 기반의 데이터로 통신하지만  
JSON이나 XML은 데이터가 커질수록 전송해야하는 양이나 파싱하는 성능도 무시할 수 없어 
이러한 라이브러리를 만들 었다.

서버와 서버간, 서버와 클라이언트 사이에 데이터를 주고 받기 위해   
어떤 자바 라이브러리를 사용할지에 대해서는  
성능 비교를 통해 사이트에 가장 적합한 라이브러리를 선택하는 것이 좋다. 

**정리**

대부분의 프로젝트에서 어떤 용도로든 XML파일을 사용한다.  
XML이나 JSON을 기반으로 데이터를 주고 받느다면  
비즈니스 로직을 처리하기 위한 시간이 아닌 데이터를 파싱하기 위해 시간이 적지 않게 든다는 점을  
반드시 염두에 두고 개발을 해야한다.  

어떤 시스템은 XML 기반으로 개발했다가 오픈후 지속적인 장애 발생으로 XML을 걷어낸 경우도 있다.  
요즘 대부분의 설정파일을 XML로 처리하는데 만약 주기적으로 설정 파일을 읽도록 한다면   
그 빈도수를 줄이기를 권장한다.  